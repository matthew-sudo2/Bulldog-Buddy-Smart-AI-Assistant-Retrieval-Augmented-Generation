# Visual Flow - Improved Fix

## Complete Query Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Asks Question                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Is this a follow-up question?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
   YES       NO
    â”‚         â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                            â”‚
    â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rewrite with    â”‚    â”‚ Check if related to  â”‚
â”‚ conversation    â”‚    â”‚ previous context     â”‚
â”‚ context         â”‚    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚
         â”‚                   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â”‚                   â”‚         â”‚
         â”‚                  YES       NO
         â”‚                   â”‚         â”‚
         â”‚                   â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
         â”‚                   â”‚    â”‚  Clear   â”‚
         â”‚                   â”‚    â”‚  Cache   â”‚
         â”‚                   â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                   â”‚         â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Retrieve Chunks from    â”‚
              â”‚  Vector Database         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ğŸ†• CHECK RELEVANCE:     â”‚
              â”‚  Are chunks relevant to  â”‚
              â”‚  THIS question?          â”‚
              â”‚  (keyword overlap > 15%) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚         â”‚
                  YES        NO
                    â”‚         â”‚
                    â”‚         â–¼
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    â”‚ âš ï¸  IRRELEVANT!     â”‚
                    â”‚    â”‚ Clear cache         â”‚
                    â”‚    â”‚ Re-retrieve chunks  â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚
                    â”‚           â–¼
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    â”‚ Check relevance     â”‚
                    â”‚    â”‚ again               â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚
                    â”‚      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚      â”‚         â”‚
                    â”‚     YES       NO
                    â”‚      â”‚         â”‚
                    â”‚      â”‚         â–¼
                    â”‚      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      â”‚    â”‚ Switch to    â”‚
                    â”‚      â”‚    â”‚ General      â”‚
                    â”‚      â”‚    â”‚ Knowledge    â”‚
                    â”‚      â”‚    â”‚ Mode         â”‚
                    â”‚      â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚      â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Update Cache with    â”‚
                â”‚ retrieved chunks     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Generate Response    â”‚
                â”‚ using LLM            â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ ğŸ†• POST-PROCESS:              â”‚
                â”‚ Ensure Proper Formatting     â”‚
                â”‚ - Add line breaks if missing â”‚
                â”‚ - Format bullet points       â”‚
                â”‚ - Space paragraphs properly  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Return Formatted     â”‚
                â”‚ Response to User     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Relevance Checking Algorithm

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query: "what if I got inc grade"       â”‚
â”‚ Keywords: [inc, got, grade]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remove stop words:                     â”‚
â”‚ [what, if, I]                          â”‚
â”‚ Remaining: [inc, got, grade]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For each retrieved chunk:              â”‚
â”‚                                        â”‚
â”‚ Chunk 1: "grading scale 4.0..."       â”‚
â”‚ Contains: grade âœ“                      â”‚
â”‚ Match: 1/3 = 33%                       â”‚
â”‚                                        â”‚
â”‚ Chunk 2: "incomplete INC grades..."   â”‚
â”‚ Contains: inc âœ“, grade âœ“               â”‚
â”‚ Match: 2/3 = 67%                       â”‚
â”‚                                        â”‚
â”‚ Chunk 3: "tuition fees payment..."    â”‚
â”‚ Contains: (none)                       â”‚
â”‚ Match: 0/3 = 0%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate Average:                     â”‚
â”‚ (33% + 67% + 0%) / 3 = 33%            â”‚
â”‚                                        â”‚
â”‚ Compare to Threshold (15%):           â”‚
â”‚ 33% > 15% âœ“                           â”‚
â”‚                                        â”‚
â”‚ Result: CHUNKS ARE RELEVANT âœ…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Before vs After Comparison

### OLD SYSTEM (Before Improved Fix)

```
Q1: "What's the tuition fee?"
    â†“
[Retrieve Financial Chunks]
    â†“
[Store in Cache] âœ“
    â†“
"The tuition fee is $10,000 per semester for undergraduate
students. This covers all course fees and materials..."
    â†“
âŒ No line breaks, compact text


Q2: "What about INC grades?"
    â†“
[Detected as follow-up]
    â†“
[Use Conversational Chain]
    â†“
[Retrieved: Still has Financial Chunks cached!] âŒ
    â†“
"INC grades allow students to complete work later. Regarding
the tuition you asked about, payment plans are available..."
    â†“
âŒ Mixed contexts! Mentioned tuition in grading answer
âŒ Still no line breaks
```

### NEW SYSTEM (After Improved Fix)

```
Q1: "What's the tuition fee?"
    â†“
[Retrieve Financial Chunks]
    â†“
[Check Relevance: 85% overlap âœ“]
    â†“
[Store in Cache] âœ“
    â†“
"The tuition fee is $10,000 per semester for undergraduate
students.

This covers all course fees and materials.

Payment options include:
â€¢ Full payment upfront
â€¢ Semester installments
â€¢ Monthly payment plans"
    â†“
âœ… Proper line breaks and formatting!


Q2: "What about INC grades?"
    â†“
[Detected as follow-up]
    â†“
[Use Conversational Chain]
    â†“
[Retrieved: Financial Chunks]
    â†“
[Check Relevance: 5% overlap âŒ] ğŸ†•
    â†“
[CLEAR CACHE + RE-RETRIEVE] ğŸ†•
    â†“
[Retrieved: Grading Chunks]
    â†“
[Check Relevance: 70% overlap âœ“] ğŸ†•
    â†“
[Update Cache with Grading Chunks]
    â†“
"According to university policy, an incomplete (INC) grade
allows you to complete coursework later.

However, the handbook doesn't specifically detail how
individual mid-semester grades are factored into the final
calculation.

I recommend speaking with your academic advisor for details
specific to your program."
    â†“
âœ… Correct context (grading only, no tuition mention)
âœ… Proper line breaks and formatting!
```

## Formatting Post-Processor Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM Output:                  â”‚
â”‚ "Text text text. More text.  â”‚
â”‚  Even more text. Bullet 1    â”‚
â”‚  Bullet 2"                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check: Does it have \n\n?    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
      â”‚         â”‚
     YES       NO
      â”‚         â”‚
      â–¼         â–¼
   Return    Process
   as-is     with regex
      â”‚         â”‚
      â”‚         â–¼
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    â”‚ Add breaks after:  â”‚
      â”‚    â”‚ . ! ? followed by  â”‚
      â”‚    â”‚ capital letter     â”‚
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚
      â”‚             â–¼
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    â”‚ Add breaks before: â”‚
      â”‚    â”‚ â€¢ - * bullets      â”‚
      â”‚    â”‚ 1. 2. numbers      â”‚
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚
      â”‚             â–¼
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚    â”‚ Add breaks after:  â”‚
      â”‚    â”‚ : colons           â”‚
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Formatted Output:    â”‚
         â”‚ "Text text text.     â”‚
         â”‚                      â”‚
         â”‚ More text.           â”‚
         â”‚                      â”‚
         â”‚ Even more text.      â”‚
         â”‚ â€¢ Bullet 1           â”‚
         â”‚ â€¢ Bullet 2"          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Relevance Threshold Impact

```
        LOW THRESHOLD (10%)        BALANCED (15%)         HIGH THRESHOLD (25%)
              â†“                          â†“                        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ More Lenient    â”‚        â”‚ Current Default â”‚      â”‚ Very Strict     â”‚
    â”‚                 â”‚        â”‚                 â”‚      â”‚                 â”‚
    â”‚ Accepts chunks  â”‚        â”‚ Good balance    â”‚      â”‚ May reject      â”‚
    â”‚ with minimal    â”‚        â”‚ between false   â”‚      â”‚ valid chunks    â”‚
    â”‚ keyword overlap â”‚        â”‚ positives and   â”‚      â”‚                 â”‚
    â”‚                 â”‚        â”‚ false negatives â”‚      â”‚ Fewer false     â”‚
    â”‚ More false      â”‚        â”‚                 â”‚      â”‚ positives but   â”‚
    â”‚ positives       â”‚        â”‚ âœ… RECOMMENDED  â”‚      â”‚ more false      â”‚
    â”‚                 â”‚        â”‚                 â”‚      â”‚ negatives       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cache State Machine

```
      START
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Empty  â”‚
   â”‚  Cache  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚ Question Asked
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Cached  â”‚â—„â”€â”€â”€â”€â”
   â”‚ Context â”‚     â”‚ Related Question
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â”‚
        â”‚          â”‚
        â”‚ Relevance Check
        â–¼          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
   â”‚Relevant?â”‚    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
        â”‚         â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”   â”‚
   â”‚         â”‚   â”‚
  YES       NO   â”‚
   â”‚         â”‚   â”‚
   â”‚         â–¼   â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    â”‚ Clear & â”‚
   â”‚    â”‚ Refresh â”‚
   â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
   â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â–º Continue
```

## Legend

```
â”Œâ”€â”€â”€â”€â”€â”
â”‚     â”‚  Process/State
â””â”€â”€â”€â”€â”€â”˜

   â–¼     Flow Direction

  ğŸ†•     New Feature Added

  âœ…     Success/Correct

  âŒ     Problem/Error

  âš ï¸      Warning/Attention Needed
```

## Summary in One Diagram

```
           USER QUESTION
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Detect Type  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚
    Follow-up         New
        â”‚               â”‚
        â–¼               â–¼
   [Rewrite Q]    [Check Cache]
        â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Retrieve     â”‚
        â”‚  Chunks       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ†• CHECK         â”‚
        â”‚ RELEVANCE        â”‚
        â”‚ Keywords Match?  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚
       YES             NO
        â”‚               â”‚
        â”‚               â–¼
        â”‚       [Clear & Retry]
        â”‚               â”‚
        â”‚               â–¼
        â”‚       [Still Bad?]
        â”‚               â”‚
        â”‚               â–¼
        â”‚       [General Mode]
        â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Generate     â”‚
        â”‚  Response     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ğŸ†• FORMAT         â”‚
        â”‚ Add Line Breaks   â”‚
        â”‚ Space Paragraphs  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Return to    â”‚
        â”‚  User         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
